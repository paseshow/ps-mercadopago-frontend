<div class="containerPadre">
    <h4>Devoluciones y cancelaciones:</h4>

    <div class="accordion mt-3 mx-auto" id="accordionExample">
        <div class="accordion-item ">
            <h2 class="accordion-header " id="headingOne">
                <button class="accordion-button containerConsideraciones" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Consideraciones:
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show containerConsideracionesItems"
                aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <ul>
                        <p>Devoluciones:
                            <li>Si el estado del pago es pending, significa que aún no se ha cobrado al comprador, por
                                lo
                                que puede realizar
                                una
                                cancelación.</li>
                            <li>Si el pago es approved, significa que se le cobró al comprador, por lo que puede
                                realizar un
                                reembolso.</li>
                            <li>Puede reembolsar un pago dentro de los 360 días posteriores a su aprobación.</li>
                        </p>

                        <p>Medios de devolución:
                            <li>Si el comprador realizó el pago con tarjeta, el importe se reembolsará directamente a la
                                tarjeta.</li>
                            <li>Si el pago se realizó por otros medios, el monto se depositará en la cuenta de Mercado
                                Pago
                                del
                                comprador.
                                Si el comprador no tiene cuenta, crearemos una utilizando la dirección de correo
                                electrónico
                                del
                                comprador.
                            </li>
                        </p>

                        <p>Devoluciones parciales:
                            <li>Puede emitir hasta 20 reembolsos parciales por un solo pago.</li>
                            <li>Si el pago se realizó por otros medios, el monto se depositará en la cuenta de Mercado
                                Pago
                                del
                                comprador.
                                Si el comprador no tiene cuenta, crearemos una utilizando la dirección de correo
                                electrónico
                                del
                                comprador.
                            </li>
                        </p>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <h5 class="ml-3 mt-4">Buscar por reserva id: <span class="text-muted">(Solo mostrara registros que su estado sea
            approved)</span></h5>
    <div class="container">
        <div class="container">
            <form [formGroup]="formSearch">
                <div class="input-group">
                    <input type="text" aria-label="First name" class="form-control" placeholder="Reserva id"
                        formControlName="reservaId">
                    <input type="text" aria-label="Last name" class="form-control" placeholder="Dni cliente"
                        formControlName="clienteDni">
                    <button class="btn btn-success" type="button" (click)="searchReserva()">
                        <i class="bx bx-search-alt-2"></i>
                        Búscar
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="container mt-4 mb-4 p-0">
        <div class="container p-0">
            <div class="row  mx-auto">
                <div class="container containerListRegistros p-0">

                    <table class="table  text-center">
                        <thead class="table-dark">
                            <tr>
                                <!-- <th scope="col textTile">ID TRANSACCION</th> -->
                                <th scope="col">RESERVA ID</th>
                                <th scope="col">FECHA RESERVA</th>
                                <th scope="col">CLIENTE</th>
                                <th scope="col">DNI CLIENTE</th>
                                <th scope="col">EMAIL CLIENTE</th>
                                <th scope="col">UBICACIÓN ID</th>
                                <th scope="col">DESCUENTO UBICACIÓN</th>
                                <th scope="col">SECTOR EVENTO</th>
                                <th scope="col">FECHA FUNCION</th>
                                <th scope="col">MONTO TOTAL</th>
                                <th scope="col">ESTADO</th>
                                <th scope="col">DEVOLUCIÓN</th>
                            </tr>
                        </thead>
                        <tbody class="tbody">
                            <tr class="listRegistro" *ngFor="let anReserva of listReservas">
                                <td>{{ anReserva.id }}</td>
                                <td>{{ anReserva.fechaReserva | date: 'short' }}</td>
                                <td>{{ anReserva.clienteNombre }}</td>
                                <td>{{ anReserva.clienteDni }}</td>
                                <td>{{ anReserva.clienteEmail }}</td>
                                <td>{{ anReserva.ubicacionEventoId }}</td>
                                <td>{{ anReserva.descuentoSectorDescripcion }}</td>
                                <td>{{ anReserva.sectorEventoDescripcion }}</td>
                                <td>{{ anReserva.sectorEventoFechaFuncion | date: 'short'}}</td>
                                <td>{{ anReserva.importeTotal }}</td>
                                <td>{{ anReserva.estado }}</td>
                                <td>
                                    <button type="button" class="btn btn-primary " data-bs-toggle="modal"
                                        data-bs-target="#staticBackdrop" (click)="dataReferenceByReservaId(anReserva)">
                                        <i class="bx bxs-arrow-to-right text-center"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">RESERVA SELECCIONADA</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Reserva Id: {{ referenceReservaSelected?.reservaId }}</p>
                <p>Id Transacción: {{ referenceReservaSelected?.idTransaccionMp }}</p>
                <p>Status: {{ referenceReservaSelected?.statusReference }}</p>

                <div *ngIf="isRefunds">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border" role="status">
                          <span class="visually-hidden">Loading...</span>
                        </div>
                      </div>
                </div>

                <div *ngIf="!isRefunds" [formGroup]="formRefunds" class="form-floating mb-3">
                    <input type="text" class="form-control" formControlName="motivo">
                    <label for="floatingInput">Motivo</label>
                    <div class="container mt-3">
                        <div class="row">
                            <div class="col-6 d-grid gap-2">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" placeholder="devolucion"
                                        aria-describedby="basic-addon1" formControlName="devolucionTotal">
                                </div>
                                <button  [disabled]="formRefunds.get('devolucionTotal').value != 'devolucion'" type="button" class="btn btn-warning"
                                    (click)="overallRefund()">
                                    Devolucion Total
                                </button>
                            </div>
                            <div class="col-6 d-grid gap-2">
                                <div class="input-group mb-3">
                                    <input type="number" class="form-control" placeholder="Monto parcial"
                                        aria-describedby="basic-addon1" formControlName="monto">
                                </div>

                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" placeholder="devolucion"
                                        aria-describedby="basic-addon1" formControlName="devolucionParcial">
                                </div>
                                <button [disabled]="validRefundsPartial()" type="button" class="btn btn-warning "
                                    (click)="refundsPartial()">
                                    Devolución parcial
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <span *ngIf="!isRefunds" class="textSpan pt-3">para habilitar botones, escribir: devolucion</span>
            </div>

            <div class="modal-footer">
                <button #btnCerrar type="button" class="btn btn-danger" data-bs-dismiss="modal">CERRAR</button>
            </div>
        </div>
    </div>
</div>